{"version":3,"sources":["../js/single.js"],"names":["singleInfo","URLSearchParams","location","search","singleId","get","getSingleData","getFilmDetails","then","d","json","singleData","singleHeader","document","getElementById","singleDesc","singlePoster","textContent","nameRu","description","src","posterUrl","SINGLE_STAR_SELECTED","SINGLE_HEART_LIKED","singleLikes","stars","querySelectorAll","getSingleMetaInfo","fetch","body","singleViews","views","likes","dataset","likesCount","ratingNumber","ratings","reduce","a","b","length","rating","String","Math","round","padEnd","ratingScore","i","lengt","star","classList","remove","add","likeHeart","LOCAL_STORAGE_LIKE","localStorage","getItem","addEventListener","contains","method","currentLikesCount","Number","setItem","$","on","ratingValue","headers","JSON","stringify"],"mappings":"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","sourcesContent":["const singleInfo=new URLSearchParams(location.search);\r\nconst singleId=singleInfo.get('id');\r\nconst getSingleData=async()=>{\r\n    const singleData=await getFilmDetails(singleId).then(d => d.json());\r\n    const singleHeader=document.getElementById('single__header');\r\n    const singleDesc=document.getElementById('single__desc');\r\n    const singlePoster=document.getElementById('single__poster');\r\n\r\n    singleHeader.textContent=singleData.nameRu;\r\n    singleDesc.textContent=singleData.description;\r\n    singlePoster.src=singleData.posterUrl;\r\n};\r\n\r\nconst SINGLE_STAR_SELECTED='rating__star-selected';\r\nconst SINGLE_HEART_LIKED='single__heart-leked';\r\nconst singleLikes=document.getElementById('single__likes');\r\nconst stars=document.querySelectorAll('.single__rating-star');\r\n\r\nconst getSingleMetaInfo=async()=>{\r\n    const { body:singleInfo }= await fetch (`http://inno-ijl.ru/multystub/stc-21-03/film/${singleId}`).then( d => d.json());\r\n    \r\n    const singleViews=document.getElementById('single__views');\r\n    \r\n    singleViews.textContent=`${singleInfo.views} Views`;\r\n    singleLikes.textContent=`${singleInfo.likes} Likes`;\r\n    singleLikes.dataset.likesCount=singleInfo.likes;\r\n\r\n    const ratingNumber=singleInfo.ratings.reduce((a,b) => +a + +b, 0)/singleInfo.ratings.length\r\n    const rating=String(Math.round(ratingNumber*10)/10).padEnd(3,'.0');\r\n    const ratingScore=document.getElementById('single__rating-score');\r\n    ratingScore.textContent=rating;\r\n\r\n    for (let i = 0;i < stars.lengt;i++) {\r\n        const star = stars[i];\r\n        if (i>=ratingNumber){\r\n            star.classList.remove(SINGLE_STAR_SELECTED)\r\n        } else{\r\n            star.classList.add(SINGLE_STAR_SELECTED)\r\n        }\r\n    };\r\n};\r\n\r\nconst likeHeart=document.getElementById('single__heart');\r\nconst LOCAL_STORAGE_LIKE=`film-like-${singleId}`;\r\n\r\nif (localStorage.getItem(LOCAL_STORAGE_LIKE)){\r\n    likeHeart.classList.add(SINGLE_HEART_LIKED)\r\n} else{\r\n    likeHeart.addEventListener('click',()=>{\r\n        if(!likeHeart.classList.contains(SINGLE_HEART_LIKED)){\r\n            fetch (`http://inno-ijl.ru/multystub/stc-21-03/film/${singleId}/like`,{   \r\n                \r\n                method:'POST',\r\n            });\r\n            likeHeart.classList.add(SINGLE_HEART_LIKED);\r\n            const currentLikesCount=Number(singleLikes.dataset.likesCount);\r\n            singleLikes.textContent=`${currentLikesCount+1} Likes`;\r\n    \r\n            localStorage.setItem(LOCAL_STORAGE_LIKE,true)\r\n        } \r\n    });\r\n};\r\n\r\n$('.block__div1').on('click','.single__rating-star',function(){\r\n    const rating= +this.dataset.ratingValue;\r\n    fetch(`http://inno-ijl.ru/multystub/stc-21-03/film/${singleId}/rating`,{\r\n        method:'POST',\r\n        headers:{\r\n            'Content-Type':'application/json',\r\n        },\r\n        body:JSON.stringify({rating}),\r\n    }).then(getSingleMetaInfo); \r\n})\r\n\r\ngetSingleData();\r\ngetSingleMetaInfo();\r\n"],"file":"single.js"}